
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Генератор постиронии</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="./styles.css">
    <link rel="script" href="./js.js">
</head>
<body onload="initialRequest()">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<header id="header" class="fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: rgb(249,66,58);">
        <div class="container">
            <a href="./index.html" class="navbar-brand"> <img class="logo" src="./icon.png" style="max-width: 62px; max-height: 62px;"> Генератор постиронии    </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarDropdown">
                <ul class="navbar-nav me-auto mg-lg-0">
                    <li class="nav-item">
                        <a href="#" class="nav-link">Другие</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">Какие-то</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">Ссылки</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" id="navDrop" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                        >А</a>
                        <ul style="background-color: rgb(175,31,36);" class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink" >
                            <li><a class="dropdown-item" href="#">можно</a></li>
                            <li><a class="dropdown-item" href="#">даже</a></li>
                            <li><a class="dropdown-item" href="#">так</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<section class="d-flex align-items-center justify-content-center">
<div class="container">
    <div class="row justify-content-center" style="text-align:center;
width:80%;
display:block;
height: 80%;
margin:auto;">
            <h1>Генератор постиронии</h1>
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
        <figure>
            <img id = "pic" class="img-fluid img-thumbnail" style="overflow: hidden;">
        </figure>
        <br>
        <br>
    <button type="button" class="btn btn-danger fixed-bottom" id="send" onclick="initialRequest()">ИСЧО</button>
    </div>
</div>
</section>

<!--<div>Первое слово на изображении подходит к нему  <button id="result1" onclick="changeText(this.id)">Да</button></div>
<div>Второе слово на изображении подходит к нему  <button id="result2" onclick="changeText(this.id)">Да</button></div>
<div>Третье слово на изображении подходит к нему  <button id="result3" onclick="changeText(this.id)">Да</button></div>
<div>Первое слово на изображении подходит ко второму  <button id="result4" onclick="changeText(this.id)">Да</button></div>
<div>Первое слово на изображении подходит к третьему  <button id="result5" onclick="changeText(this.id)">Да</button></div>
<div>Второе слово на изображении подходит к третьему  <button id="result6" onclick="changeText(this.id)">Да</button></div> -->
<script>
    /*function requestKek()
    {
        let form = "";
        if (document.getElementById(result1).textContent === "Да") form += '1 ';
        else form += '0 ';
        if (document.getElementById(result2).textContent === "Да") form += '1 ';
        else form += '0 ';
        if (document.getElementById(result3).textContent === "Да") form += '1   ';
        else form += '0 ';
        if (document.getElementById(result4).textContent === "Да") form += '1 ';
        else form += '0 ';
        if (document.getElementById(result5).textContent === "Да") form += '1 ';
        else form += '0 ';
        if (document.getElementById(result6).textContent === "Да") form += '1';
        else form += '0';
        let url = new URL('http://localhost:8080/g1');
        url.searchParams.set('form', form);
        let xhr = new XMLHttpRequest();
        xhr.open("GET", url, [true]);
        xhr.send();
        xhr.onload = function() {
            if (xhr.status != 200) {
                alert(`Ошибка ${xhr.status}: ${xhr.statusText}`);
            }
            else {
                var canvas = document.getElementById('pic');

                if (canvas.getContext){
                    painter(xhr.response);
                } else {
                    alert("Ваш браузер не поддерживает кеки...");
                }
            }
        };
    }
    function changeText(id)
    {
        if ( document.getElementById(id).textContent == "Да") document.getElementById(id).textContent = "Нет"
        else document.getElementById(id).textContent = "Да"
    } */

    function downscale(image){
        var canvas = document.getElementById("pic");
        var ctx = canvas.getContext("2d");
        var img = new Image();

        img.onload = function () {

            // set size proportional to image
            canvas.height = canvas.width * (img.height / img.width);

            // step 1 - resize to 50%
            var oc = document.createElement('canvas'),
                octx = oc.getContext('2d');

            oc.width = img.width * 0.5;
            oc.height = img.height * 0.5;
            octx.drawImage(img, 0, 0, oc.width, oc.height);

            // step 2
            octx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5);

            // step 3, resize to final size
            ctx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5,
                0, 0, canvas.width, canvas.height);
        }
        img.src = "data:image/jpeg;base64,"+image;
    }

    function painter(data){
        const obj = JSON.parse(data);
        var image = document.getElementById("pic");
        //var ctx = canvas.getContext("2d");
        const width  = window.innerWidth || document.documentElement.clientWidth ||
            document.body.clientWidth;
        const height = window.innerHeight|| document.documentElement.clientHeight||
            document.body.clientHeight;
        //var image = new Image();
        //image.onload = function() {
            //canvas.width = obj.width;
            //canvas.height = obj.height;
            //ctx.drawImage(image, 0, 0);
        //};
        image.src = "data:image/jpeg;base64,"+obj.image;
        //downscale(obj.image);
    }

    function initialRequest() {
        let url = new URL('http://localhost:8080/g1');
        let xhr = new XMLHttpRequest();
        xhr.open("GET", url, [true]);
        xhr.send();
        xhr.onload = function() {
            if (xhr.status != 200) {
                alert(`Ошибка ${xhr.status}: ${xhr.statusText}`);
            }
            else {
                painter(xhr.response);
            }
        };

    }
</script>
</body>
</html>